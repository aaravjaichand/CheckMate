<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - CheckMate</title>
    
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/dashboard-glass.css">
    <link rel="stylesheet" href="/css/pages-glass.css">
    <link rel="stylesheet" href="/css/liquid-nav.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    .class-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 32px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .class-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #f0f0f0;
    }

    .class-title {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .class-title h2 {
        margin: 0;
        color: #2d3748;
        font-size: 24px;
        font-weight: 600;
    }

    .class-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }

    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
    }

    .analytics-card {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    .analytics-card h3 {
        margin: 0 0 16px 0;
        color: #2d3748;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .student-dropdown {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        background: white;
        font-size: 14px;
        margin-bottom: 16px;
    }

    .grade-display {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 16px;
        border-radius: 8px;
        text-align: center;
    }

    .grade-display .grade-value {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .grade-display .grade-details {
        font-size: 14px;
        opacity: 0.9;
    }

    .class-average {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
    }

    .class-average .average-value {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .class-average .average-label {
        font-size: 16px;
        opacity: 0.9;
    }

    .performer-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .performer-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .performer-item:last-child {
        border-bottom: none;
    }

    .performer-rank {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        color: #333;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
    }

    .performer-info {
        flex: 1;
        margin-left: 12px;
    }

    .performer-name {
        font-weight: 600;
        color: #2d3748;
    }

    .performer-score {
        font-size: 14px;
        color: #666;
    }

    .score-badge {
        padding: 4px 8px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }

    .score-high {
        background: #d4edda;
        color: #155724;
    }

    .score-medium {
        background: #fff3cd;
        color: #856404;
    }

    .score-low {
        background: #f8d7da;
        color: #721c24;
    }

    .support-list {
        max-height: 300px;
        overflow-y: auto;
    }

    .support-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        margin-bottom: 8px;
        background: #fff5f5;
        border-radius: 8px;
        border-left: 4px solid #e53e3e;
    }

    .support-info {
        flex: 1;
    }

    .support-name {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 4px;
    }

    .support-details {
        font-size: 12px;
        color: #666;
    }

    .priority-badge {
        padding: 4px 8px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .priority-high {
        background: #fed7d7;
        color: #c53030;
    }

    .priority-medium {
        background: #feebc8;
        color: #dd6b20;
    }

    .priority-low {
        background: #e6fffa;
        color: #285e61;
    }

    .recommendations-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 24px;
        border-radius: 12px;
        margin-top: 24px;
    }

    .recommendations-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .refresh-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .refresh-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .refresh-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .recommendation-topics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
    }

    .topic-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .topic-title {
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .topic-priority {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        text-transform: uppercase;
    }

    .topic-priority.high {
        background: rgba(255, 107, 107, 0.8);
    }

    .topic-priority.medium {
        background: rgba(255, 193, 7, 0.8);
    }

    .topic-priority.low {
        background: rgba(72, 187, 120, 0.8);
    }

    .topic-description {
        font-size: 14px;
        margin-bottom: 12px;
        opacity: 0.9;
    }

    .topic-activities {
        font-size: 12px;
        opacity: 0.8;
    }

    .topic-activities ul {
        margin: 8px 0 0 0;
        padding-left: 16px;
    }

    .class-strategy {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 16px;
        border-left: 4px solid rgba(255, 255, 255, 0.5);
    }

    .loading-spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    .empty-state i {
        font-size: 48px;
        margin-bottom: 16px;
        color: #ccc;
    }

            .no-classes {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            margin-top: 40px;
            color: #2d3748;
        }

        .no-classes i {
            font-size: 64px;
            color: #ddd;
            margin-bottom: 20px;
        }

        .no-classes h3 {
            color: #2d3748;
        }

        .no-classes p {
            color: #4a5568;
        }

    .class-selector-section {
        margin-bottom: 32px;
    }

    .selector-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 24px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .selector-card h3 {
        margin: 0 0 16px 0;
        color: #2d3748;
        font-size: 18px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .class-dropdown {
        width: 100%;
        padding: 16px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        background: white;
        font-size: 16px;
        font-weight: 500;
        color: #2d3748;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .class-dropdown:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .class-dropdown:hover {
        border-color: #a0aec0;
    }
</style>
</head>
<body class="dashboard-body">
    <!-- Liquid Glass Navigation -->
    <nav class="liquid-nav">
        <a href="/" class="nav-brand-liquid">
            <i class="fas fa-graduation-cap"></i>
            <span>CheckMate</span>
        </a>
        
        <div class="nav-items">
            <a href="/pages/dashboard.html" class="nav-item-liquid">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="/pages/upload.html" class="nav-item-liquid">
                <i class="fas fa-upload"></i>
                <span>Upload</span>
            </a>
            <a href="/pages/grading.html" class="nav-item-liquid">
                <i class="fas fa-check-double"></i>
                <span>Grading</span>
            </a>
            <a href="/pages/analytics.html" class="nav-item-liquid active">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
            <a href="/pages/settings.html" class="nav-item-liquid">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>
        
        <div class="nav-user-liquid">
            <div class="user-info-liquid">
                <div class="user-name-liquid">Teacher Name</div>
                <div class="user-plan-liquid">Pro Plan</div>
            </div>
            <div class="user-avatar-liquid" onclick="toggleDropdown()">
                <i class="fas fa-user"></i>
            </div>
            <div class="dropdown-liquid" id="userDropdown">
                <a href="/pages/settings.html" class="dropdown-item-liquid">
                    <i class="fas fa-cog"></i>
                    Settings
                </a>
                <a href="/" class="dropdown-item-liquid">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
        <nav class="sidebar-nav">
            <a href="/pages/dashboard.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="/pages/upload.html" class="nav-item">
                <i class="fas fa-upload"></i>
                <span>Upload</span>
            </a>
            <a href="/pages/grading.html" class="nav-item">
                <i class="fas fa-check-double"></i>
                <span>Grading</span>
            </a>
            <a href="/pages/analytics.html" class="nav-item active">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
            <a href="/pages/settings.html" class="nav-item">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="main-header">
            <h1>Class Analytics & Insights</h1>
            <p>Comprehensive performance analytics for your classes</p>
        </div>

        <!-- Class Selector -->
        <div class="class-selector-section" id="class-selector-section" style="display: none;">
            <div class="selector-card">
                <h3><i class="fas fa-chalkboard-teacher"></i> Select Class</h3>
                <select class="class-dropdown" id="class-selector" onchange="loadClassData()">
                    <option value="">Choose a class to view analytics...</option>
                </select>
            </div>
        </div>
<!-- Loading State -->
<div id="loading-state" class="empty-state" style="display: none;">
    <div class="loading-spinner"></div>
    <p>Loading analytics data...</p>
</div>
<!-- No Classes State -->
<div id="no-classes-state" class="no-classes" style="display: none;">
    <i class="fas fa-chalkboard-teacher"></i>
    <h3>No Classes Found</h3>
    <p>Create some classes and upload worksheets to see analytics.</p>
        </div>

        <!-- Selected Class Content -->
        <div id="selected-class-content" style="display: none;">
            <!-- Selected class analytics will be dynamically inserted here -->
        </div>
    </main>
    <!-- Scripts -->
    <script src="/js/dashboard.js"></script>
    <script src="/js/user.js"></script>
    <script>
        let analyticsData = null;
        let selectedClassData = null;

        // Initialize analytics
        document.addEventListener('DOMContentLoaded', () => {
            loadAnalytics();
        });

        async function loadAnalytics() {
            try {
                showLoading(true);

                // Check authentication first
                const userData = localStorage.getItem('user');
                const token = localStorage.getItem('gradeflow_token');

                console.log('Analytics auth check:', {
                    hasUser: !!userData,
                    hasToken: !!token,
                    tokenLength: token ? token.length : 0
                });

                if (!userData || !token) {
                    console.log('No authentication found, redirecting to login');
                    window.location.href = '/pages/login.html';
                    return;
                }

                const response = await fetch('/api/analytics/classes', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        console.log('Authentication failed, redirecting to login');
                        localStorage.removeItem('user');
                        localStorage.removeItem('gradeflow_token');
                        window.location.href = '/pages/login.html';
                        return;
                    }
                    throw new Error(`Failed to load analytics: ${response.status} ${response.statusText}`);
                }

                analyticsData = await response.json();
                console.log('Analytics data received:', analyticsData);
                setupClassSelector(analyticsData);

            } catch (error) {
                console.error('Error loading analytics:', error);
                showError('Failed to load analytics data');
            } finally {
                showLoading(false);
            }
        }

                function setupClassSelector(data) {
            console.log('Setting up class selector with data:', data);
            
            if (!data.classes || data.classes.length === 0) {
                console.log('No classes found, showing no-classes state');
                document.getElementById('no-classes-state').style.display = 'block';
                return;
            }

            console.log('Found', data.classes.length, 'classes, showing selector');
            
            // Show class selector
            document.getElementById('class-selector-section').style.display = 'block';
            
            // Populate dropdown
            const selector = document.getElementById('class-selector');
            selector.innerHTML = '<option value="">Choose a class to view analytics...</option>' +
                data.classes.map(classData => 
                    `<option value="${classData.classId}">${classData.className} (${classData.subject} • Grade ${classData.gradeLevel})</option>`
                ).join('');
            
            console.log('Class selector populated with options:', selector.options.length);
        }

                            function loadClassData() {
                                const selector = document.getElementById('class-selector');
                                const selectedClassId = selector.value;
            
                            if (!selectedClassId) {
                                document.getElementById('selected-class-content').style.display = 'none';
                                return;
                            }

                            // Find the selected class data
                            selectedClassData = analyticsData.classes.find(c => c.classId === selectedClassId);
            
                            if (selectedClassData) {
                                renderSelectedClass(selectedClassData);
                                loadStudentGrades(selectedClassData.classId);
                            }
                        }

                                        function renderSelectedClass(classData) {
                                            const content = document.getElementById('selected-class-content');
                                            content.style.display = 'block';
            
                                        content.innerHTML = renderClassSection(classData);
                                    }

                                    function renderClassSection(classData) {
                                        return `
                <div class="class-section">
            
                    <div class="analytics-grid">
                        <!-- Student Grade Dropdown -->
                        <div class="analytics-card">
                            <h3><i class="fas fa-user-graduate"></i> Student Grades</h3>
                            <select class="student-dropdown" id="student-dropdown-${classData.classId}" onchange="showStudentGrade('${classData.classId}')">
                                <option value="">Select a student...</option>
                            </select>
                            <div id="grade-display-${classData.classId}" class="grade-display" style="display: none;">
                                <div class="grade-value">--</div>
                                <div class="grade-details">Select a student to see their grade</div>
            </div>
        </div>

                        <!-- Class Average -->
                        <div class="analytics-card">
                            <div class="class-average">
                                <div class="average-value">${classData.metrics.averageScore}%</div>
                                <div class="average-label">Average Class Score</div>
                                <div style="font-size: 14px; margin-top: 8px; opacity: 0.8;">
                                    ${classData.metrics.totalPointsEarned}/${classData.metrics.totalPoints} total points
                </div>
            </div>
        </div>

                <!-- Top Performers -->
                        <div class="analytics-card">
                            <h3><i class="fas fa-trophy"></i> Top Performers</h3>
                            ${classData.topPerformers.length > 0 ? `
                                <ul class="performer-list">
                                    ${classData.topPerformers.map(student => `
                                        <li class="performer-item">
                                            <div class="performer-rank">${student.rank}</div>
                                            <div class="performer-info">
                                                <div class="performer-name">${student.studentName}</div>
                                                <div class="performer-score">${student.totalWorksheets} worksheets</div>
                    </div>
                                            <span class="score-badge score-high">${student.averageScore}% (${student.grade})</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            ` : `
                        <div class="empty-state">
                            <i class="fas fa-trophy"></i>
                            <p>No performance data available</p>
                                </div>
                            `}
                </div>

                <!-- Students Needing Support -->
                        <div class="analytics-card">
                            <h3><i class="fas fa-hands-helping"></i> Students Needing Support</h3>
                            ${classData.studentsNeedingSupport.length > 0 ? `
                                <div class="support-list">
                                    ${classData.studentsNeedingSupport.map(student => `
                                        <div class="support-item">
                                            <div class="support-info">
                                                <div class="support-name">${student.studentName}</div>
                                                <div class="support-details">${student.totalWorksheets} worksheets • ${student.averageScore}% average</div>
                                            </div>
                                            <span class="priority-badge priority-${student.priority}">${student.priority}</span>
                                        </div>
                                    `).join('')}
                    </div>
                            ` : `
                        <div class="empty-state">
                            <i class="fas fa-hands-helping"></i>
                                    <p>All students performing well!</p>
                                </div>
                            `}
                    </div>
                </div>

                    <!-- AI Recommendations -->
                    <div class="recommendations-section">
                        <div class="recommendations-header">
                            <h3><i class="fas fa-robot"></i> AI-Powered Recommendations</h3>
                            <button class="refresh-btn" onclick="refreshRecommendations('${classData.classId}', '${classData.className}')" id="refresh-btn-${classData.classId}">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                    </div>
                        <div id="recommendations-${classData.classId}">
                            <p style="opacity: 0.8;">Click refresh to generate AI recommendations for this class.</p>
                        </div>
                    </div>
                </div>
            `;
                                }

                                                async function loadStudentGrades(classId) {
                                                    try {
                                                        const token = localStorage.getItem('gradeflow_token');
                                                        if (!token) {
                                                            console.log('No token found, redirecting to login');
                                                            window.location.href = '/pages/login.html';
                                                            return;
                                                        }

                                                    const response = await fetch(`/api/analytics/classes/${classId}/student-grades`, {
                                                        headers: {
                                                            'Authorization': `Bearer ${token}`
                                                        }
                                                    });

                                                    if (!response.ok) {
                                                        if (response.status === 401) {
                                                            localStorage.removeItem('user');
                                                            localStorage.removeItem('gradeflow_token');
                                                            window.location.href = '/pages/login.html';
                                                            return;
                                                        }
                                                    throw new Error('Failed to load student grades');
                                                }

                                                    const data = await response.json();
                                                    const dropdown = document.getElementById(`student-dropdown-${classId}`);

                                                    dropdown.innerHTML = '<option value="">Select a student...</option>' +
                                                        data.students.map(student =>
                                                            `<option value="${JSON.stringify({
                                                                name: student.studentName,
                                                                points: student.totalPointsEarned,
                                                                total: student.totalPoints,
                                                                percentage: student.percentage,
                                                                grade: student.letterGrade,
                                                                worksheets: student.worksheetCount
                                                            }).replace(/"/g, '&quot;')}">${student.studentName}</option>`
                                                        ).join('');

                                                } catch (error) {
                                                    console.error('Error loading student grades:', error);
                                                }
        }

                                        function showStudentGrade(classId) {
                                            const dropdown = document.getElementById(`student-dropdown-${classId}`);
                                            const gradeDisplay = document.getElementById(`grade-display-${classId}`);

                                            if (dropdown.value) {
                                                const studentData = JSON.parse(dropdown.value.replace(/&quot;/g, '"'));

                                                gradeDisplay.style.display = 'block';
                                                gradeDisplay.innerHTML = `
                    <div class="grade-value">${studentData.percentage}% (${studentData.grade})</div>
                    <div class="grade-details">
                        ${studentData.points}/${studentData.total} points earned<br>
                        ${studentData.worksheets} worksheets completed
                    </div>
                `;
                                            } else {
                                                gradeDisplay.style.display = 'none';
                                            }
                                        }

    async function refreshRecommendations(classId, className) {
        const refreshBtn = document.getElementById(`refresh-btn-${classId}`);
        const recommendationsDiv = document.getElementById(`recommendations-${classId}`);

        try {
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<div class="loading-spinner"></div> Generating...';
        
            recommendationsDiv.innerHTML = '<p style="opacity: 0.8;"><div class="loading-spinner" style="margin-right: 8px;"></div>Analyzing class performance and generating recommendations...</p>';

            const token = localStorage.getItem('gradeflow_token');
            if (!token) {
                console.log('No token found, redirecting to login');
                window.location.href = '/pages/login.html';
                return;
            }

            const response = await fetch(`/api/analytics/classes/${classId}/ai-recommendations`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to generate recommendations');
            }

            const data = await response.json();
            renderRecommendations(recommendationsDiv, data.recommendations);

        } catch (error) {
            console.error('Error generating recommendations:', error);
            recommendationsDiv.innerHTML = '<p style="color: #ffcccc;">Failed to generate recommendations. Please try again.</p>';
        } finally {
            refreshBtn.disabled = false;
            refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
        }
    }

        function renderRecommendations(container, recommendations) {
            if (!recommendations || !recommendations.topics) {
                container.innerHTML = '<p style="opacity: 0.8;">No recommendations available.</p>';
                return;
            }

        container.innerHTML = `
                ${recommendations.topics.length > 0 ? `
                    <div class="recommendation-topics">
                        ${recommendations.topics.map(topic => `
                            <div class="topic-card">
                                <div class="topic-title">
                                    ${topic.topic}
                                    <span class="topic-priority ${topic.priority}">${topic.priority}</span>
                                </div>
                                <div class="topic-description">${topic.description}</div>
                                <div class="topic-activities">
                                    <strong>Suggested Activities:</strong>
                                    <ul>
                                        ${topic.suggestedActivities.map(activity => `<li>${activity}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                ${recommendations.classStrategy ? `
                    <div class="class-strategy">
                        <h4 style="margin: 0 0 12px 0;"><i class="fas fa-lightbulb"></i> Class Strategy</h4>
                        <p style="margin: 0; opacity: 0.9;">${recommendations.classStrategy}</p>
                    </div>
                ` : ''}
            `;
    }

    function showLoading(show) {
        document.getElementById('loading-state').style.display = show ? 'block' : 'none';
        if (show) {
            // Hide everything when loading
            document.getElementById('class-selector-section').style.display = 'none';
            document.getElementById('selected-class-content').style.display = 'none';
            document.getElementById('no-classes-state').style.display = 'none';
            }
                // When not loading, the setupClassSelector or error functions will show the appropriate elements
        }

                                                function showError(message) {
                                                    document.getElementById('class-selector-section').style.display = 'none';
                                                    document.getElementById('selected-class-content').style.display = 'none';
                                                    document.getElementById('no-classes-state').innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Analytics</h3>
                <p>${message}</p>
                <button onclick="loadAnalytics()" style="margin-top: 16px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    Try Again
                </button>
            `;
                                                    document.getElementById('no-classes-state').style.display = 'block';
        }

                                        // Liquid dropdown functions
                                        function toggleDropdown() {
                                            const dropdown = document.getElementById('userDropdown');
                                            dropdown.classList.toggle('active');
                                        }

                                        // Close dropdown when clicking outside
                                        document.addEventListener('click', function (event) {
                                            if (!event.target.closest('.nav-user-liquid')) {
                                                document.getElementById('userDropdown').classList.remove('active');
                                            }
                                        });
    </script>

    <!-- Floating Background Elements -->
    <div class="floating-element floating-element-1"></div>
    <div class="floating-element floating-element-2"></div>
    <div class="floating-element floating-element-3"></div>
</body>
</html>